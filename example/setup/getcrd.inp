* GENERATED BY CHARMM-GUI (http://www.charmm-gui.org) VERSION on Jul, 11. 2014.
* INPUT FILE FOR NPT DYNAMICS OF SOLVATED GLOBULAR PROTEIN
*

! Read topology and parameter files
stream toppar.str

! Read PSF and Coordinates
open read unit 10 card name step3_pbcsetup.psf
read psf  unit 10 card

open read unit 10 card name step4_equilibration.crd
read coor unit 10 card

!
! Setup PBC (Periodic Boundary Condition)
!

stream step3_pbcsetup.str

open read unit 10 card name crystal_image.str
CRYSTAL DEFINE @XTLtype @A @B @C @alpha @beta @gamma
CRYSTAL READ UNIT 10 CARD

!Image centering by residue
IMAGE BYRESID XCEN @xcen YCEN @ycen ZCEN @zcen sele resname TIP3 end
IMAGE BYRESID XCEN @xcen YCEN @ycen ZCEN @zcen sele ( segid @posid .or. segid @negid ) end

!
! Nonbonded Options
!

nbonds atom vatom vfswitch bycb -
       ctonnb 10.0 ctofnb 12.0 cutnb 16.0 cutim 16.0 -
       inbfrq -1 imgfrq -1 wmin 1.0 cdie eps 1.0 -
       ewald pmew fftx @fftx ffty @ffty fftz @fftz  kappa .34 spline order 6
energy

!
!use a restraint to place center of mass of the molecules near the origin
!

MMFP
GEO rcm sphere -
    Xref @xcen Yref @ycen Zref @zcen XDIR 1.0 YDIR 1.0 ZDIR 1.0 -
    harmonic FORCE 1.0 select .not. ( hydrogen .or. resname TIP3 .or. segid @posid .or. segid @negid ) end
END

!
! NPT dynamics :
! you can change
! nstep  : number of MD steps
! nprint : print-out frequency
! nsavc  : the trajectory saving frequency
!

! estimate Pmass from SYSmass (total system mass)
! [there could be problems with exreme values, such as  Pmass << SYSmass or Pmass >> SYSmass
scalar mass stat
calc Pmass = int ( ?stot  /  50.0 )

shake bonh param

!save frame 100ps (step = 100,000)
open read unit 51 file name step5_1.dcd

trajectory query unit 51

trajectory iread 51 begin ?start skip ?skip

set i 1
label loop

trajectory read

increment i
if i le 10 goto loop

open write unit 10 card name eq.pdb
write coor unit 10 pdb

open write unit 10 card name eq.crd
write coor unit 10 card
close unit 10

stop
